# OxideTerm IDE æ¨¡å¼

> è½»é‡çº§è¿œç¨‹å¼€å‘ç¯å¢ƒï¼Œåœ¨ç»ˆç«¯ä¸ä»£ç ç¼–è¾‘ä¹‹é—´æ— ç¼åˆ‡æ¢

## ğŸ“– æ¦‚è¿°

IDE æ¨¡å¼æ˜¯ OxideTerm çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œè®©ä½ æ— éœ€å®‰è£… VS Code Remote æˆ–é…ç½®è¿œç¨‹å¼€å‘æœåŠ¡å™¨ï¼Œå³å¯ç›´æ¥åœ¨ SSH è¿æ¥ä¸Šè¿›è¡Œä»£ç ç¼–è¾‘ã€æ–‡ä»¶æµè§ˆå’Œç»ˆç«¯æ“ä½œã€‚

### æ ¸å¿ƒä¼˜åŠ¿

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **é›¶é…ç½®** | æ— éœ€åœ¨è¿œç¨‹æœåŠ¡å™¨å®‰è£…ä»»ä½• Agent æˆ–æ’ä»¶ |
| **è½»é‡å¿«é€Ÿ** | åŸºäº SFTP åè®®ï¼Œå¤ç”¨ç°æœ‰ SSH è¿æ¥ |
| **åŸç”Ÿä½“éªŒ** | CodeMirror 6 ç¼–è¾‘å™¨ï¼Œæ”¯æŒè¯­æ³•é«˜äº®ã€è‡ªåŠ¨è¡¥å…¨ |
| **Git é›†æˆ** | å®æ—¶æ˜¾ç¤ºæ–‡ä»¶ä¿®æ”¹çŠ¶æ€å’Œåˆ†æ”¯ä¿¡æ¯ |
| **è‡ªæ„ˆè¿æ¥** | v1.4.0 å¼•å…¥çš„å¼ºä¸€è‡´æ€§è¿æ¥æ¶æ„ï¼Œæ–­ç½‘é‡è¿ä¸ä¸¢å¤±ä¸Šä¸‹æ–‡ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿›å…¥ IDE æ¨¡å¼

1. åœ¨è¿æ¥åˆ—è¡¨ä¸­å³é”®ç‚¹å‡»ä¸€ä¸ª SSH è¿æ¥
2. é€‰æ‹© **ã€Œä»¥ IDE æ¨¡å¼æ‰“å¼€ã€**
3. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­é€‰æ‹©è¿œç¨‹é¡¹ç›®ç›®å½•
4. ç‚¹å‡»ç¡®è®¤ï¼Œå³å¯è¿›å…¥ IDE å·¥ä½œåŒº

æˆ–è€…åœ¨å·²è¿æ¥çš„ç»ˆç«¯ä¼šè¯ä¸­ï¼Œç‚¹å‡»å·¥å…·æ çš„ **ã€ŒIDEã€** æŒ‰é’®åˆ‡æ¢ã€‚

## ğŸ–¼ï¸ ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡¹ç›®åç§°                                        âŒ˜ main â†‘1      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           â”‚  [file1.ts] [file2.rs] [config.json â—]              â”‚
â”‚  ğŸ“ src   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ğŸ“„ main â”‚                                                     â”‚
â”‚   ğŸ“„ lib  â”‚              CodeMirror ç¼–è¾‘å™¨                       â”‚
â”‚  ğŸ“ docs  â”‚                                                     â”‚
â”‚  ğŸ“„ READMEâ”‚                                                     â”‚
â”‚           â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  $ ~/project  â–Œ                                                 â”‚
â”‚  ç»ˆç«¯é¢æ¿ï¼ˆå¯æŠ˜å ï¼‰                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Ln 42, Col 15  â”‚  UTF-8  â”‚  TypeScript  â”‚  main â†‘1 â†“0         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŒºåŸŸè¯´æ˜

| åŒºåŸŸ | åŠŸèƒ½ |
|------|------|
| **æ–‡ä»¶æ ‘ï¼ˆå·¦ä¾§ï¼‰** | æµè§ˆé¡¹ç›®æ–‡ä»¶ï¼Œæ”¯æŒå±•å¼€/æŠ˜å ç›®å½•ï¼Œæ˜¾ç¤º Git çŠ¶æ€é¢œè‰² |
| **æ ‡ç­¾æ ** | å·²æ‰“å¼€çš„æ–‡ä»¶æ ‡ç­¾ï¼Œ`â—` è¡¨ç¤ºæœ‰æœªä¿å­˜çš„ä¿®æ”¹ |
| **ç¼–è¾‘å™¨** | CodeMirror 6 ç¼–è¾‘å™¨ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€è¯­æ³•é«˜äº® |
| **ç»ˆç«¯é¢æ¿** | é›†æˆ SSH ç»ˆç«¯ï¼Œå¯æ‰§è¡Œå‘½ä»¤ã€è¿è¡Œç¨‹åº |
| **çŠ¶æ€æ ** | æ˜¾ç¤ºå…‰æ ‡ä½ç½®ã€æ–‡ä»¶ç¼–ç ã€è¯­è¨€ã€Git åˆ†æ”¯ä¿¡æ¯ |

## âš™ï¸ æ ¸å¿ƒæµç¨‹ä¸æ¶æ„ (v1.4.0)

OxideTerm v1.4.0 å½»åº•é‡æ„äº† IDE æ¨¡å¼çš„è¿æ¥ç®¡ç†ï¼Œé‡‡ç”¨äº† **"å¼ºä¸€è‡´æ€§åŒæ­¥"** å’Œ **"Key-Driven é‡ç½®"** æ¶æ„ï¼Œç¡®ä¿åœ¨æå…¶ä¸ç¨³å®šçš„ç½‘ç»œç¯å¢ƒä¸‹ä¹Ÿèƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

### 1. å¼ºä¸€è‡´æ€§åŒæ­¥æ¶æ„

IDE æ¨¡å¼çš„æ‰€æœ‰ IO æ“ä½œï¼ˆæ–‡ä»¶è¯»å–ã€Git åˆ·æ–°ã€ä¿å­˜ï¼‰éƒ½å¿…é¡»ç»è¿‡ä¸¥æ ¼çš„çŠ¶æ€é—¨ç¦ï¼š

```mermaid
sequenceDiagram
    participant User
    participant IdeTree
    participant IdeStore
    participant AppStore
    participant Backend

    Note over IdeStore, AppStore: State Gating Check
    
    User->>IdeTree: å±•å¼€ç›®å½• / ä¿å­˜æ–‡ä»¶
    IdeTree->>IdeStore: Action (e.g. readDir)
    
    IdeStore->>TreeStore: assertNodeReady(nodeId)
    
    alt Connection Active
        AppStore-->>IdeStore: Status: Active
        IdeStore->>Backend: SFTP / SSH Exec
        Backend-->>IdeStore: Result
        IdeStore-->>IdeTree: Update UI
    else Connection Broken / Reconnecting
        AppStore-->>IdeStore: Status: Moving/Down
        IdeStore-->>IdeTree: ğŸš« Block IO (Show Loading)
    end
```

### 2. Key-Driven è‡ªåŠ¨é‡ç½®ä¸è‡ªæ„ˆ

ä¸ºäº†è§£å†³ SSH é‡è¿åæ—§çŠ¶æ€æ®‹ç•™çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†åŸºäº React Key çš„ç‰©ç†çº§é‡ç½®æœºåˆ¶ï¼š

```tsx
// AppLayout.tsx
// å½“é‡è¿å‘ç”Ÿ (connectionId æ”¹å˜)ï¼Œæ•´ä¸ª IDE æ ‘è¢«é”€æ¯å¹¶é‡å»º
<IdeWorkspace nodeId={nodeId} rootPath={rootPath} />
```

**ç”Ÿå‘½å‘¨æœŸï¿½ï¿½è½¬**ï¼š
1. **æ–­ç½‘**ï¼šBackend é‡è¿ï¼Œå‰ä¸€ä¸ª `connectionId` å¤±æ•ˆã€‚
2. **é”€æ¯**ï¼šReact å¸è½½æ—§ç»„ä»¶ï¼Œè‡ªåŠ¨æ¸…ç†æ‰€æœ‰ Pending çš„ SFTP è¯·æ±‚ã€Watcher å’Œå„ç§å†…å­˜çŠ¶æ€ã€‚
3. **é‡å»º**ï¼šé‡è¿æˆåŠŸï¼Œç”Ÿæˆæ–° `connectionId`ï¼Œç»„ä»¶é‡æ–°æŒ‚è½½ã€‚
4. **æ¢å¤**ï¼š
    - ä» `ideStore` çš„ `cachedProjectPath` å’Œ `cachedTabPaths` æ¢å¤ä¸Šæ¬¡çš„çŠ¶æ€ã€‚
    - é‡æ–°è®¢é˜… Git çŠ¶æ€å˜æ›´ã€‚
    - é‡æ–°åŠ è½½æ–‡ä»¶æ ‘æ ¹ç›®å½•ã€‚

### 3. å¤š Store ååŒ

IDE æ¨¡å¼ä¸ä»…ä»…ä¾èµ–å•ä¸€ Storeï¼Œè€Œæ˜¯ä¸‰ä¸ª Store çš„åå¥æ›²ï¼š

```mermaid
graph TD
    subgraph Context ["User Intent Context"]
        IdeStore["ideStore<br/>(File Tree, Tabs, Search)"]
    end
    
    subgraph Fact ["Backend Truth"]
        AppStore["appStore<br/>(ConnectionId, State)"]
    end
    
    subgraph Logic ["Logic Driver"]
        TreeStore["sessionTreeStore<br/>(Connect/Disconnect Actions)"]
    end
    
    TreeStore -->|1. Connect Action| AppStore
    TreeStore -->|2. Force Refresh| AppStore
    
    AppStore -->|3. Source of Truth| IdeStore
    
    IdeStore -->|4. IO Gating| AppStore
    
    style IdeStore fill:#e3f2fd,stroke:#1565c0
    style AppStore fill:#fce4ec,stroke:#c2185b
    style TreeStore fill:#fff3cd,stroke:#fbc02d
```

## ğŸŒ³ æ–‡ä»¶æ ‘åŠŸèƒ½

### Git çŠ¶æ€æŒ‡ç¤º

æ–‡ä»¶æ ‘ä¸­çš„æ–‡ä»¶ä¼šæ ¹æ® Git çŠ¶æ€æ˜¾ç¤ºä¸åŒé¢œè‰²ï¼š

| é¢œè‰² | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ğŸŸ¡ é»„è‰² | Modified | å·²ä¿®æ”¹ |
| ğŸŸ¢ ç»¿è‰² | Added | æ–°å¢ï¼ˆå·²æš‚å­˜ï¼‰ |
| ğŸ”´ çº¢è‰² | Deleted | å·²åˆ é™¤ |
| ğŸ”µ è“è‰² | Renamed | é‡å‘½å |
| âš« ç°è‰² | Untracked | æœªè·Ÿè¸ª |
| ğŸ”´ æ·±çº¢ | Conflict | å†²çª |

### è¡Œä¸ºé©±åŠ¨åˆ·æ–° (Behavior-Driven Refresh)

ä¸ºäº†å‡å°‘ SSH æµé‡ï¼ŒGit çŠ¶æ€ä¸å†ä½¿ç”¨è½®è¯¢ï¼Œè€Œæ˜¯ç”±ç”¨æˆ·è¡Œä¸ºè§¦å‘ï¼š

- **æ–‡ä»¶ä¿å­˜**: `ideStore.saveFile()` -> è§¦å‘åˆ·æ–°
- **æ–‡ä»¶æ“ä½œ**: æ–°å»º/åˆ é™¤/é‡å‘½å -> è§¦å‘åˆ·æ–°
- **ç»ˆç«¯å›è½¦**: åœ¨é›†æˆç»ˆç«¯æŒ‰ Enter é”® -> å»¶è¿Ÿ 500ms è§¦å‘åˆ·æ–° (æ™ºèƒ½æ•è· CLI git å‘½ä»¤)
- **çª—å£èšç„¦**: çª—å£é‡æ–°è·å¾—ç„¦ç‚¹ -> è§¦å‘åˆ·æ–°

## ğŸ“ ç¼–è¾‘å™¨åŠŸèƒ½

### æ–‡ä»¶å†²çªå¤„ç† (Data Consistency)

å½“ä¿å­˜æ–‡ä»¶æ—¶ï¼ŒIDE ä¼šæ‰§è¡Œ "ä¹è§‚é”" æ£€æŸ¥ï¼š

1. **ä¿å­˜å‰**: è·å–è¿œç¨‹æ–‡ä»¶ `mtime`ã€‚
2. **æ¯”è¾ƒ**: ä¸æ–‡ä»¶æ‰“å¼€æ—¶çš„ `mtime` å¯¹æ¯”ã€‚
3. **å†²çª**: å¦‚æœè¿œç¨‹æ›´æ–°ï¼Œå¼¹å‡ºå†²çªè§£å†³å¯¹è¯æ¡†ã€‚
    - **è¦†ç›–ä¿å­˜**ï¼šç”¨æœ¬åœ°å†…å®¹è¦†ç›–è¿œç¨‹æ–‡ä»¶
    - **é‡æ–°åŠ è½½**ï¼šæ”¾å¼ƒæœ¬åœ°ä¿®æ”¹ï¼ŒåŠ è½½è¿œç¨‹æœ€æ–°å†…å®¹

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### æœç´¢ç¼“å­˜ç­–ç•¥

ä¸ºäº†åœ¨è¿œç¨‹ SFTP ç¯å¢ƒä¸‹æä¾›æµç•…çš„å…¨å±€æœç´¢ï¼š

- **ç¼“å­˜é”®**: `Query + Options + ConnectionId`
- **TTL**: 60 ç§’ (æ–‡ä»¶å˜åŠ¨è‡ªåŠ¨å¤±æ•ˆ)
- **å¤±æ•ˆæœºåˆ¶**: ä»»ä½•æ–‡ä»¶å†™å…¥æ“ä½œéƒ½ä¼šæ¸…ç©ºå½“å‰è¿æ¥çš„æœç´¢ç¼“å­˜

### è·¯å¾„è®°å¿† (Path Memory)

ç»„ä»¶é‡è£…ä¸åº”ä¸¢å¤±ä¸Šä¸‹æ–‡ã€‚`ideStore` ä½¿ç”¨æŒä¹…åŒ–çŠ¶æ€å­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼š

```typescript
// ideStore.ts - ä½¿ç”¨ Zustand persist ä¸­é—´ä»¶
interface IdeState {
  // Core state
  nodeId: string;                     // å…³è”çš„ä¼šè¯æ ‘èŠ‚ç‚¹ ID
  terminalSessionId: string | null;   // é›†æˆç»ˆç«¯çš„ä¼šè¯ ID
  project: ProjectInfo | null;        // å½“å‰é¡¹ç›®ä¿¡æ¯
  tabs: IdeTab[];                     // æ‰“å¼€çš„æ ‡ç­¾é¡µåˆ—è¡¨
  activeTabId: string | null;         // å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µ ID
  treeWidth: number;                  // æ–‡ä»¶æ ‘é¢æ¿å®½åº¦
  terminalHeight: number;             // ç»ˆç«¯é¢æ¿é«˜åº¦
  terminalVisible: boolean;           // ç»ˆç«¯é¢æ¿æ˜¯å¦å¯è§
  expandedPaths: Set<string>;         // å·²å±•å¼€çš„ç›®å½•è·¯å¾„
  treeRefreshSignal: number;          // æ–‡ä»¶æ ‘åˆ·æ–°ä¿¡å·
  conflictState: ConflictState | null; // æ–‡ä»¶å†²çªçŠ¶æ€

  // Cached (persisted across reconnects)
  cachedProjectPath: string | null;   // ä¸Šæ¬¡æ‰“å¼€çš„é¡¹ç›®è·¯å¾„
  cachedTabPaths: string[];           // ä¸Šæ¬¡æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„åˆ—è¡¨
  cachedNodeId: string | null;        // ä¸Šæ¬¡å…³è”çš„èŠ‚ç‚¹ ID
  lastClosedAt: number | null;        // ä¸Šæ¬¡å…³é—­æ—¶é—´
}

// æ‰“å¼€é¡¹ç›®æ—¶è‡ªåŠ¨ç¼“å­˜
set({
  cachedProjectPath: projectInfo.rootPath,
  cachedTabPaths: [...new Set([...state.cachedTabPaths, path])],
});
```

## ğŸ“‹ å·²çŸ¥é™åˆ¶

| é™åˆ¶ | è¯´æ˜ |
|------|------|
| æ–‡ä»¶å¤§å° | å»ºè®® < 10MBï¼Œå¤§æ–‡ä»¶ä¼šåˆ‡æ¢åˆ°åªè¯»æ¨¡å¼ |
| äºŒè¿›åˆ¶æ–‡ä»¶ | ä¸æ”¯æŒç¼–è¾‘ï¼Œä¼šæç¤ºæ‰“å¼€ Hex æŸ¥çœ‹å™¨ |
| å®æ—¶åä½œ | ä¸æ”¯æŒå¤šäººåŒæ—¶ç¼–è¾‘ |
| LSP | æš‚ä¸æ”¯æŒè¯­è¨€æœåŠ¡å™¨åè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨åŸºäºæœ¬åœ° CodeMirrorï¼‰ |

## ğŸ—ºï¸ è·¯çº¿å›¾

### è®¡åˆ’ä¸­çš„åŠŸèƒ½

- [ ] å¤šå…‰æ ‡ç¼–è¾‘
- [ ] ä»£ç æŠ˜å 
- [ ] å°åœ°å›¾ (Minimap)
- [ ] æ–‡ä»¶æ¯”è¾ƒ (Diff View)
- [ ] ä¹¦ç­¾ç³»ç»Ÿ
- [ ] ç‰‡æ®µç®¡ç† (Snippets)

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.4.0 | é€‚é…æ¶æ„: Strong Sync + Key-Driven Reset*
