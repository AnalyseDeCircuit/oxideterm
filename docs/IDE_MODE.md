# OxideTerm IDE 模式

> 轻量级远程开发环境，在终端与代码编辑之间无缝切换

## 📖 概述

IDE 模式是 OxideTerm 的核心特性之一，让你无需安装 VS Code Remote 或配置远程开发服务器，即可直接在 SSH 连接上进行代码编辑、文件浏览和终端操作。

### 核心优势

| 特性 | 说明 |
|------|------|
| **零配置** | 无需在远程服务器安装任何 Agent 或插件 |
| **轻量快速** | 基于 SFTP 协议，复用现有 SSH 连接 |
| **原生体验** | CodeMirror 6 编辑器，支持语法高亮、自动补全 |
| **Git 集成** | 实时显示文件修改状态和分支信息 |
| **项目搜索** | 全项目 grep 搜索，快速定位代码 |

## 🚀 快速开始

### 进入 IDE 模式

1. 在连接列表中右键点击一个 SSH 连接
2. 选择 **「以 IDE 模式打开」**
3. 在弹出的对话框中选择远程项目目录
4. 点击确认，即可进入 IDE 工作区

或者在已连接的终端会话中，点击工具栏的 **「IDE」** 按钮切换。

## 🖼️ 界面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  项目名称                                        ⌘ main ↑1      │
├───────────┬─────────────────────────────────────────────────────┤
│           │  [file1.ts] [file2.rs] [config.json ●]              │
│  📁 src   ├─────────────────────────────────────────────────────┤
│   📄 main │                                                     │
│   📄 lib  │              CodeMirror 编辑器                       │
│  📁 docs  │                                                     │
│  📄 README│                                                     │
│           │                                                     │
├───────────┴─────────────────────────────────────────────────────┤
│  $ ~/project  ▌                                                 │
│  终端面板（可折叠）                                               │
├─────────────────────────────────────────────────────────────────┤
│  Ln 42, Col 15  │  UTF-8  │  TypeScript  │  main ↑1 ↓0         │
└─────────────────────────────────────────────────────────────────┘
```

### 区域说明

| 区域 | 功能 |
|------|------|
| **文件树（左侧）** | 浏览项目文件，支持展开/折叠目录，显示 Git 状态颜色 |
| **标签栏** | 已打开的文件标签，`●` 表示有未保存的修改 |
| **编辑器** | CodeMirror 6 编辑器，支持多种编程语言语法高亮 |
| **终端面板** | 集成 SSH 终端，可执行命令、运行程序 |
| **状态栏** | 显示光标位置、文件编码、语言、Git 分支信息 |

## ⌨️ 快捷键

### 文件操作

| 快捷键 | 功能 |
|--------|------|
| `Cmd/Ctrl + S` | 保存当前文件 |
| `Cmd/Ctrl + Shift + S` | 保存所有文件 |
| `Cmd/Ctrl + W` | 关闭当前标签 |
| `Cmd/Ctrl + Shift + W` | 关闭所有标签 |

### 编辑器

| 快捷键 | 功能 |
|--------|------|
| `Cmd/Ctrl + F` | 文件内搜索 |
| `Cmd/Ctrl + G` | 跳转到行号 |
| `Cmd/Ctrl + D` | 选中下一个相同单词 |
| `Cmd/Ctrl + /` | 切换注释 |
| `Tab` | 缩进 |
| `Shift + Tab` | 取消缩进 |

### 面板控制

| 快捷键 | 功能 |
|--------|------|
| `` Cmd/Ctrl + ` `` | 切换终端面板显示 |
| `Cmd/Ctrl + B` | 切换文件树显示 |
| `Cmd/Ctrl + Shift + F` | 打开项目搜索 |

## 🌳 文件树功能

### Git 状态指示

文件树中的文件会根据 Git 状态显示不同颜色：

| 颜色 | 状态 | 说明 |
|------|------|------|
| 🟡 黄色 | Modified | 已修改 |
| 🟢 绿色 | Added | 新增（已暂存） |
| 🔴 红色 | Deleted | 已删除 |
| 🔵 蓝色 | Renamed | 重命名 |
| ⚫ 灰色 | Untracked | 未跟踪 |
| 🔴 深红 | Conflict | 冲突 |

### 操作

- **单击目录**：展开/折叠
- **双击文件**：在编辑器中打开
- **右键菜单**：更多操作（重命名、删除等）
- **刷新按钮**：重新加载文件列表
- **切换目录**：点击顶部文件夹图标选择其他项目目录

## 📝 编辑器功能

### 支持的语言

IDE 模式支持 50+ 种编程语言的语法高亮：

- **Web**: TypeScript, JavaScript, HTML, CSS, Vue, React
- **系统**: Rust, Go, C/C++, Python, Java
- **脚本**: Shell, PowerShell, Lua, Ruby, Perl
- **配置**: JSON, YAML, TOML, XML, Markdown
- **数据库**: SQL, GraphQL

### 自动检测

编辑器会根据文件扩展名自动选择语言模式，也可以在状态栏手动切换。

### 文件冲突处理

当保存文件时，如果远程文件已被其他进程修改，会弹出冲突对话框：

- **覆盖保存**：用本地内容覆盖远程文件
- **重新加载**：放弃本地修改，加载远程最新内容
- **取消**：保持现状，稍后手动处理

## 🔍 项目搜索

### 使用方法

1. 按 `Cmd/Ctrl + Shift + F` 打开搜索面板
2. 输入搜索关键词
3. 结果按文件分组显示
4. 点击结果项跳转到对应位置

### 搜索特性

- **实时搜索**：输入时自动搜索（300ms 防抖）
- **结果缓存**：60 秒内相同搜索直接返回缓存
- **上下文显示**：显示匹配行的前后内容
- **正则支持**：支持正则表达式搜索（计划中）

## 💻 集成终端

### 特性

- 复用 SSH 连接，无需额外认证
- 自动 `cd` 到项目根目录
- 支持所有终端功能（颜色、历史、Tab 补全等）
- 可调整面板高度

### 行为驱动刷新

终端与编辑器状态智能同步：

- 在终端执行 `git` 命令后，Git 状态自动刷新
- 修改文件后，文件树状态实时更新
- 窗口重新获得焦点时自动检查变更

## ⚙️ 配置选项

### 布局持久化

- 文件树宽度
- 终端面板高度
- 面板显示/隐藏状态

这些设置会自动保存，下次打开时恢复。

### 标签管理

- 最多同时打开 20 个标签
- 超出时自动关闭最早未使用的标签
- 未保存的文件会提示保存

## 🔧 技术实现

### 架构

```
┌─────────────────────────────────────────────────────────────┐
│                      前端 (React)                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  IdeTree    │  │  IdeEditor  │  │    IdeTerminal      │ │
│  │  (文件树)    │  │ (CodeMirror)│  │    (xterm.js)       │ │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘ │
│         │                │                     │            │
│         └────────────────┴─────────────────────┘            │
│                          │                                  │
│                    Tauri IPC                                │
├─────────────────────────────────────────────────────────────┤
│                      后端 (Rust)                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ SFTP 会话   │  │ SSH 连接池  │  │  终端会话管理       │ │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘ │
│         └────────────────┴─────────────────────┘            │
│                          │                                  │
│                    SSH 协议                                 │
└─────────────────────────────────────────────────────────────┘
                           │
                    远程服务器
```

### 关键技术

| 组件 | 技术 |
|------|------|
| 编辑器 | CodeMirror 6 |
| 终端 | xterm.js + WebGL 渲染 |
| 文件操作 | SFTP 协议 |
| 状态管理 | Zustand |
| Git 状态 | `git status --porcelain` 命令解析 |

### 性能优化

- **搜索缓存**：60 秒 TTL，避免重复远程 grep
- **行为驱动刷新**：替代轮询，降低 SSH 流量
- **细粒度订阅**：Zustand selector 优化，减少无效重渲染
- **增量加载**：文件树按需加载子目录

## 📋 已知限制

| 限制 | 说明 |
|------|------|
| 文件大小 | 建议 < 1MB，大文件会切换到只读模式 |
| 二进制文件 | 不支持编辑，会提示打开 Hex 查看器 |
| 实时协作 | 不支持多人同时编辑 |
| LSP | 暂不支持语言服务器协议（自动补全基于本地） |

## 🗺️ 路线图

### 计划中的功能

- [ ] 多光标编辑
- [ ] 代码折叠
- [ ] 小地图 (Minimap)
- [ ] 文件比较 (Diff View)
- [ ] 书签系统
- [ ] 片段管理 (Snippets)

## 💡 使用建议

1. **小项目优先**：IDE 模式最适合快速编辑配置文件、脚本或小型项目
2. **配合终端使用**：编辑代码后直接在终端运行/调试
3. **善用搜索**：项目搜索比手动查找更高效
4. **注意保存**：养成 `Cmd+S` 的习惯，避免丢失更改

---

*IDE 模式持续优化中，欢迎反馈建议！*
