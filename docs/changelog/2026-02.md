# OxideTerm å˜æ›´æ—¥å¿— - 2026å¹´2æœˆ

## 2026-02-10: russh 0.54 å‡çº§ & SSH Agent è®¤è¯ (v1.8.0)

### âœ¨ æ–°ç‰¹æ€§

#### 1. russh 0.49 â†’ 0.54 å‡çº§ï¼ˆring å¯†ç å­¦åç«¯ï¼‰

å°† SSH åè®®åº“ä» russh 0.49 å‡çº§è‡³ 0.54ï¼Œåˆ‡æ¢åˆ° `ring` å¯†ç å­¦åç«¯ï¼š

- **é›¶ C/OpenSSL ä¾èµ–**ï¼šæ•´ä¸ª SSH è·¯å¾„çš„å¯†ç å­¦æ ˆæ”¹ä¸ºçº¯ Rustï¼ˆringï¼‰ï¼Œå½»åº•æ¶ˆé™¤ C ç¼–è¯‘ä¾èµ–
- **API é€‚é…**ï¼šå¤„ç† russh 0.54 çš„ RPITITï¼ˆReturn Position Impl Trait In Traitï¼‰å˜æ›´ï¼Œæ‰€æœ‰ `Signer` trait å®ç°éœ€æ»¡è¶³ `Send` bound
- **å¯†ç å¥—ä»¶**ï¼šChaCha20-Poly1305ã€AES-GCMï¼Œå¯†é’¥ç±»å‹ Ed25519/RSA/ECDSA

**æ”¹åŠ¨æ–‡ä»¶**ï¼š
- `src-tauri/Cargo.toml` â€” russh ç‰ˆæœ¬ `0.49` â†’ `0.54`ï¼Œæ·»åŠ  `default-features = false, features = ["ring"]`
- `src-tauri/src/ssh/` â€” é€‚é…æ–°ç‰ˆ API ç­¾å

#### 2. SSH Agent è®¤è¯ï¼ˆAgentSignerï¼‰

å®ç°ç³»ç»Ÿ SSH Agent é›†æˆï¼Œæ”¯æŒ Unix å’Œ Windows å¹³å°ï¼š

- **AgentSigner**ï¼šè‡ªç ” `AgentSigner` ç»“æ„ä½“å°è£…ç³»ç»Ÿ SSH Agentï¼Œæ»¡è¶³ russh 0.54 çš„ `Signer` trait
- **RPITIT Send bound è§£å†³æ–¹æ¡ˆ**ï¼šé€šè¿‡å°† `&PublicKey` å…‹éš†ä¸º owned å€¼ï¼Œé¿å…è·¨ `.await` çš„å€Ÿç”¨é—®é¢˜
- **å¹³å°æ”¯æŒ**ï¼šUnix (`SSH_AUTH_SOCK` ç¯å¢ƒå˜é‡) å’Œ Windows (`\\.\pipe\openssh-ssh-agent` å‘½åç®¡é“)
- **ä»£ç†é“¾å…¼å®¹**ï¼šProxyJump é“¾ä¸­æ¯ä¸€è·³å¯ç‹¬ç«‹ä½¿ç”¨ Agent è®¤è¯
- **é‡è¿éŸ§æ€§**ï¼š`AuthMethod::Agent` åœ¨è‡ªåŠ¨é‡è¿æ—¶è‡ªåŠ¨é‡æ”¾
- **å‰ç«¯çŠ¶æ€æŒ‡ç¤º**ï¼šæš´éœ² `is_agent_available` å‘½ä»¤è‡³å‰ç«¯ï¼Œè¿æ¥è¡¨å•æ˜¾ç¤º Agent å¯ç”¨çŠ¶æ€

**æ”¹åŠ¨æ–‡ä»¶**ï¼š
- `src-tauri/src/ssh/agent.rs` â€” AgentSigner å®ç°
- `src-tauri/src/ssh/client.rs` â€” Agent è®¤è¯æµç¨‹é›†æˆ
- `src-tauri/src/commands/` â€” `is_agent_available` IPC å‘½ä»¤
- `src/components/connections/` â€” Agent çŠ¶æ€æŒ‡ç¤ºå™¨ UI

#### 3. å‰ç«¯å¯¹è¯æ¡†ç°ä»£åŒ–

å°†æ‰€æœ‰ `window.confirm` è°ƒç”¨æ›¿æ¢ä¸ºåŸºäº React çš„å¼‚æ­¥å¯¹è¯æ¡†ï¼š

- **Tauri WebView å…¼å®¹**ï¼šTauri 2.0 WebView ä¸æ”¯æŒåŒæ­¥ `window.confirm`ï¼Œæ”¹ç”¨ `useConfirm` Hook
- **UI ä¸€è‡´æ€§**ï¼šæ‰€æœ‰ç¡®è®¤å¯¹è¯æ¡†é£æ ¼ä¸åº”ç”¨ä¸»é¢˜ç»Ÿä¸€

**æ”¹åŠ¨æ–‡ä»¶**ï¼š
- `src/hooks/useConfirm.ts` â€” æ–°å¢å¼‚æ­¥ç¡®è®¤ Hook
- å¤šä¸ªç»„ä»¶æ–‡ä»¶ â€” æ›¿æ¢ `window.confirm` è°ƒç”¨

### ğŸ”§ ä¿®å¤

#### 1. å†…å­˜æ³„æ¼ä¿®å¤ï¼ˆHealthRegistry / ProfilerRegistry / TransferManagerï¼‰

ä¿®å¤ä¸‰å¤„å†…å­˜æ³„æ¼é—®é¢˜ï¼š

- **HealthRegistry**ï¼šè¿æ¥æ–­å¼€åå¥åº·æ£€æŸ¥æ¡ç›®æœªæ¸…ç†ï¼Œé•¿æœŸè¿è¡Œå¯¼è‡´å†…å­˜å¢é•¿
- **ProfilerRegistry**ï¼šèµ„æºç›‘æ§å™¨æ¡ç›®åœ¨ä¼šè¯å…³é—­åæ®‹ç•™
- **TransferManager**ï¼šå·²å®Œæˆ/å–æ¶ˆçš„ä¼ è¾“ä»»åŠ¡è®°å½•æœªè‡ªåŠ¨æ¸…ç†

**æ”¹åŠ¨æ–‡ä»¶**ï¼š
- `src-tauri/src/session/health.rs` â€” æ·»åŠ è¿æ¥æ–­å¼€æ—¶çš„æ¸…ç†é€»è¾‘
- `src-tauri/src/session/profiler.rs` â€” æ·»åŠ ä¼šè¯å…³é—­æ—¶çš„æ¸…ç†é€»è¾‘
- `src-tauri/src/sftp/transfer.rs` â€” å®ç°è‡ªåŠ¨æ¸…ç†æœºåˆ¶

#### 2. æ‹“æ‰‘è®¤è¯æ˜ å°„ä¿®å¤

`topology_auth_to_session_auth` å‡½æ•°çš„ catch-all åˆ†æ”¯é™é»˜å°†æœªçŸ¥è®¤è¯ç±»å‹æ˜ å°„ä¸º Agentï¼Œå¯èƒ½å¯¼è‡´é”™è¯¯çš„è®¤è¯å°è¯•ã€‚å·²ä¿®å¤ä¸ºæ­£ç¡®å¤„ç†æœªçŸ¥ç±»å‹ã€‚

**æ”¹åŠ¨æ–‡ä»¶**ï¼š
- `src-tauri/src/session/topology_graph.rs` â€” ä¿®å¤ catch-all æ˜ å°„é€»è¾‘

#### 3. æ­»ä»£ç æ¸…ç†

ç§»é™¤ä¸å†ä½¿ç”¨çš„ `agent_not_supported` i18n é”®å’Œç›¸å…³å®¡è®¡ä¿®å¤ã€‚

**æ”¹åŠ¨æ–‡ä»¶**ï¼š
- `src/locales/` â€” æ¸…ç†å¤šè¯­è¨€æ–‡ä»¶ä¸­çš„åºŸå¼ƒé”®

### ğŸ“ æ–‡æ¡£

#### 1. README å…¨é¢é‡å†™ï¼ˆä¸‰è¯­è¨€ï¼‰

é‡å†™ README.mdï¼ˆè‹±æ–‡ï¼‰ã€README.zh-CN.mdï¼ˆä¸­æ–‡ï¼‰ã€README.fr.mdï¼ˆæ³•æ–‡ï¼‰ï¼š

- **æ–°å¢æ¶æ„æ¦‚è§ˆå›¾**ï¼ˆASCII æ–‡æœ¬ï¼‰æ›¿ä»£ Mermaid æµç¨‹å›¾
- **æ–°å¢ã€Œä¸ºä»€ä¹ˆéœ€è¦ OxideTermã€å¯¹æ¯”è¡¨**
- **æ–°å¢æŠ€æœ¯äº®ç‚¹**ï¼šrussh 0.54ã€AgentSignerã€NodeRouterã€èµ„æºç›‘æ§å™¨
- **æ–°å¢åŠŸèƒ½çŸ©é˜µè¡¨**ï¼šä¸€è§ˆæ‰€æœ‰åŠŸèƒ½ç±»åˆ«
- **æ›´æ–°æŠ€æœ¯æ ˆè¡¨**ï¼šè¡¥å…… SFTPã€WebSocketã€Wire Protocolã€Plugins è¡Œ
- **æ¢å¤ç»†èŠ‚å†…å®¹**ï¼šWindows æ·±åº¦ä¼˜åŒ–ã€åç«¯æ»šåŠ¨ç¼“å†²åŒºã€Multi-Store æ¶æ„è¡¨ã€åŠŸèƒ½ç‰¹æ€§ä»‹ç»
- **æ›´æ–°è·¯çº¿å›¾**ï¼šåæ˜  v1.8.0 å·²å‘å¸ƒçŠ¶æ€

#### 2. æ’ä»¶æ–‡æ¡£åŒæ­¥

åŒæ­¥æ’ä»¶ç³»ç»Ÿæ–‡æ¡£ä¸ Phase 4.5 Node æŠ½è±¡ + API å˜æ›´ã€‚

**æ”¹åŠ¨æ–‡ä»¶**ï¼š
- `docs/PLUGIN_SYSTEM.md` â€” æ›´æ–° API å‚è€ƒ
- `docs/PLUGIN_DEVELOPMENT.md` â€” æ›´æ–°å¼€å‘æŒ‡å—

#### 3. ç»¼åˆæ–‡æ¡£å®¡è®¡

è·¨ 20+ æ–‡æ¡£æ–‡ä»¶ä¿®å¤ 150+ å¤„ä¸ä¸€è‡´ï¼ŒåŒ…æ‹¬è¿‡æ—¶çš„ API ç­¾åã€é”™è¯¯çš„æ¨¡å—è·¯å¾„ã€ç¼ºå¤±çš„åŠŸèƒ½æè¿°ç­‰ã€‚

---

## 2026-02-09: è¿è¡Œæ—¶æ’ä»¶ç³»ç»Ÿ (v1.6.2)

### âœ¨ æ–°ç‰¹æ€§

#### è¿è¡Œæ—¶åŠ¨æ€æ’ä»¶ç³»ç»Ÿ

å®Œæ•´å®ç° Membrane-based Direct Injection æ’ä»¶æ¶æ„ï¼Œå…è®¸ç¬¬ä¸‰æ–¹å¼€å‘è€…ç¼–å†™æ’ä»¶å¹¶åœ¨è¿è¡Œæ—¶å®‰è£…/å¸è½½/å¯ç”¨/ç¦ç”¨ã€‚

**æ ¸å¿ƒèƒ½åŠ›**ï¼š
- **PluginContext APIï¼ˆ8 ä¸ªå‘½åç©ºé—´ï¼‰**ï¼šconnectionsã€eventsã€uiã€terminalã€settingsã€i18nã€storageã€api
- **è¿æ¥ç”Ÿå‘½å‘¨æœŸé’©å­**ï¼šonConnect / onDisconnect / onReconnect / onLinkDown / onIdle
- **UI è§†å›¾æ‰©å±•**ï¼šæ³¨å†Œè‡ªå®šä¹‰ Tab å’Œä¾§è¾¹æ é¢æ¿
- **ç»ˆç«¯å¢å¼º**ï¼šè¾“å…¥æ‹¦æˆªã€è¾“å‡ºå¤„ç†ã€è‡ªå®šä¹‰å¿«æ·é”®
- **æ’ä»¶é—´é€šä¿¡**ï¼šå‘½åç©ºé—´éš”ç¦»çš„äº‹ä»¶ç³»ç»Ÿ

**å®‰å…¨æ¨¡å‹**ï¼š
- `Object.freeze()` + `Proxy` membrane å±‚ï¼Œæ‰€æœ‰çŠ¶æ€å¿«ç…§åªè¯»
- å›è°ƒé”™è¯¯ç†”æ–­ï¼š60s å†… 10 æ¬¡å¼‚å¸¸è‡ªåŠ¨ç¦ç”¨æ’ä»¶
- ç»ˆç«¯ fail-openï¼šæ’ä»¶å¼‚å¸¸ä¸é˜»å¡ç»ˆç«¯ I/O
- IPC ç™½åå•ï¼šåªä»£ç† manifest å£°æ˜çš„ Tauri å‘½ä»¤
- è·¯å¾„éå†æ£€æµ‹ï¼š`..` æ£€æŸ¥é˜²æ­¢è¶Šæƒæ–‡ä»¶è¯»å–

**æ”¹åŠ¨æ–‡ä»¶ï¼ˆæ–°å¢ 15 ä¸ªï¼Œä¿®æ”¹ 11 ä¸ªï¼‰**ï¼š

*å‰ç«¯æ–°å¢ï¼š*
- `src/types/plugin.ts`ï¼šæ’ä»¶ç±»å‹å®šä¹‰
- `src/store/pluginStore.ts`ï¼šæ’ä»¶çŠ¶æ€ + UI ç»„ä»¶æ³¨å†Œè¡¨
- `src/lib/plugin/pluginLoader.ts`ï¼šå‘ç°ã€æ ¡éªŒã€åŠ è½½ã€å¸è½½ç”Ÿå‘½å‘¨æœŸ
- `src/lib/plugin/pluginContextFactory.ts`ï¼šMembrane éš”ç¦»çš„ PluginContext æ„å»º
- `src/lib/plugin/pluginEventBridge.ts`ï¼šappStore â†’ æ’ä»¶äº‹ä»¶æ´¾å‘
- `src/lib/plugin/pluginTerminalHooks.ts`ï¼šè¾“å…¥/è¾“å‡ºç®¡é“ + å¿«æ·é”®æŸ¥æ‰¾
- `src/lib/plugin/pluginSettingsManager.ts`ï¼šæ’ä»¶è®¾ç½®è¯»å†™ä¸æŒä¹…åŒ–
- `src/lib/plugin/pluginI18nManager.ts`ï¼šæ’ä»¶ i18n å‘½åç©ºé—´æ³¨å†Œ
- `src/lib/plugin/pluginStorage.ts`ï¼šæ’ä»¶ä½œç”¨åŸŸ localStorage å°è£…
- `src/lib/plugin/pluginUIKit.tsx`ï¼šæ’ä»¶ä¸“ç”¨ UI ç»„ä»¶åº“ï¼ˆ24 ä¸ªçº¯ React ç»„ä»¶ï¼‰
- `src/lib/plugin/pluginIconResolver.ts`ï¼šLucide å›¾æ ‡å â†’ React ç»„ä»¶åŠ¨æ€è§£æ
- `src/components/plugin/PluginTabRenderer.tsx`ï¼šæ’ä»¶ Tab è§†å›¾æ¸²æŸ“å™¨
- `src/components/plugin/PluginSidebarRenderer.tsx`ï¼šæ’ä»¶ä¾§è¾¹æ é¢æ¿æ¸²æŸ“å™¨
- `src/components/plugin/PluginManagerView.tsx`ï¼šæ’ä»¶ç®¡ç†ç•Œé¢

*åç«¯æ–°å¢ï¼š*
- `src-tauri/src/commands/plugin.rs`ï¼šæ‰«æç›®å½•ã€è¯»æ–‡ä»¶ã€é…ç½®è¯»å†™

*ä¿®æ”¹ï¼š*
- `src/main.tsx`ï¼šæš´éœ² `window.__OXIDE__`ï¼ˆReact / ReactDOM / zustand / lucide-react / pluginUIKitï¼‰
- `src/App.tsx`ï¼šå¯åŠ¨æ—¶åˆå§‹åŒ–æ’ä»¶ç³»ç»Ÿ
- `src/types/index.ts`ï¼š`TabType` æ·»åŠ  `'plugin'`ï¼Œ`Tab` æ·»åŠ  `pluginTabId?` / `icon?`
- `src/store/appStore.ts`ï¼š`createTab` æ·»åŠ  plugin åˆ†æ”¯
- `src/store/settingsStore.ts`ï¼š`SidebarSection` æ‰©å±•æ”¯æŒ `plugin:` å‰ç¼€
- `src/components/layout/Sidebar.tsx`ï¼šä¸‰åŒºå¸ƒå±€ï¼ˆtopButtons/åˆ†éš”çº¿/bottomButtonsï¼‰+ æ’ä»¶é¢æ¿æ³¨å…¥
- `src/components/layout/TabBar.tsx`ï¼š`PluginTabIcon` ç»„ä»¶ + `resolvePluginIcon` é›†æˆ
- `src/components/layout/AppLayout.tsx`ï¼šTab æ¸²æŸ“æ·»åŠ  plugin åˆ†æ”¯
- `src/components/terminal/TerminalView.tsx`ï¼šæå– `handleWsMessage`ï¼›æ³¨å…¥è¾“å…¥/è¾“å‡ºç®¡é“
- `src/hooks/useTerminalKeyboard.ts`ï¼šæ·»åŠ æ’ä»¶å¿«æ·é”®æŸ¥æ‰¾
- `src-tauri/src/commands/mod.rs` + `lib.rs`ï¼šæ³¨å†Œ plugin å‘½ä»¤æ¨¡å—

#### æ’ä»¶ UI ç»„ä»¶åº“ (Plugin UI Kit)

æä¾› 24 ä¸ªçº¯ React ç»„ä»¶ä¾›æ’ä»¶ä½¿ç”¨ï¼Œè‡ªåŠ¨éµå¾ªå®¿ä¸»ä¸»é¢˜ï¼ˆCSS å˜é‡ï¼‰ï¼š

ScrollView, Header, Text, Card, Button, Input, Select, Checkbox, Toggle, Badge, KV, Stat, Grid, Stack, Divider, ListItem, EmptyState, Alert, Progress, Tabs, TabsList, TabsTrigger, TabsContent, Tooltip

**å®‰å…¨å®¡è®¡**ï¼ˆ5 è½®ï¼Œ20+ issues å…¨éƒ¨ä¿®å¤ï¼‰ï¼š
- Button é»˜è®¤ `type="button"` é˜²æ­¢è¡¨å•è¯¯æäº¤
- Select `onChange` ä¿ç•™ `number` åŸå§‹ç±»å‹
- ListItem é”®ç›˜æ— éšœç¢ï¼ˆ`role="button"` / `tabIndex` / `onKeyDown`ï¼‰
- æ‰€æœ‰ Tailwind ç±»ä½¿ç”¨é™æ€å®Œæ•´ç±»å

#### æ’ä»¶å›¾æ ‡åŠ¨æ€è§£æ

- `resolvePluginIcon(name)` é€šè¿‡ `lucide-react` çš„ `icons` å¯¹è±¡æ”¯æŒ PascalCase å›¾æ ‡åæ˜ å°„
- Sidebar å’Œ TabBar è‡ªåŠ¨æ¸²æŸ“ manifest å£°æ˜çš„å›¾æ ‡ï¼ŒæœªçŸ¥åç§°å›é€€ä¸º Puzzle

**æ–‡æ¡£**ï¼š
- `docs/PLUGIN_SYSTEM.md`ï¼šå®Œæ•´è®¾è®¡æ–‡æ¡£ï¼ˆv1.1ï¼ŒçŠ¶æ€æ›´æ–°ä¸º"å·²å®æ–½"ï¼‰
- `docs/PLUGIN_DEVELOPMENT.md`ï¼šæ’ä»¶å¼€å‘æŒ‡å—ï¼ˆ~3000 è¡Œï¼‰

## 2026-02-08: è¿œç¨‹ç¯å¢ƒæ£€æµ‹ & AI ä¸Šä¸‹æ–‡å¢å¼º (v1.6.1)

### âœ¨ æ–°ç‰¹æ€§

#### SSH è¿œç¨‹ç¯å¢ƒè‡ªåŠ¨æ£€æµ‹

**é—®é¢˜**ï¼šAI å†…è”åŠ©æ‰‹ï¼ˆInline Chatï¼‰å’Œä¾§è¾¹æ èŠå¤©ä»…æ³¨å…¥æœ¬æœº OS ä¿¡æ¯ï¼ˆ`navigator.platform`ï¼‰ï¼Œæ— æ³•ä¸ºç”¨æˆ·æä¾›é’ˆå¯¹è¿œç¨‹æœåŠ¡å™¨ OS/æ¶æ„/Shell çš„å‡†ç¡®å»ºè®®ã€‚

**è§£å†³**ï¼šSSH è¿æ¥å»ºç«‹åè‡ªåŠ¨å¼‚æ­¥æ£€æµ‹è¿œç¨‹ç¯å¢ƒï¼Œç»“æœæ³¨å…¥ AI Promptï¼š

**æ£€æµ‹æµç¨‹**ï¼ˆåŒé˜¶æ®µï¼‰ï¼š
1. **Phase A**ï¼ˆåˆ¤æ–­å¹³å°ï¼‰ï¼šè¿è¡Œ `echo $PSModulePath` â€”â€” éç©º = Windowsï¼Œç©º = Unix
2. **Phase B**ï¼ˆé‡‡é›†ä¿¡æ¯ï¼‰ï¼š
   - **Unix**ï¼š`uname -s && uname -r && uname -m && echo "$SHELL"`
   - **Windows**ï¼š`systeminfo | findstr /C:"OS Name" /C:"OS Version" /C:"System Type" && echo %COMSPEC%`
3. **MINGW/MSYS/Cygwin æ£€æµ‹**ï¼š`uname -s` è¾“å‡º `MINGW64_NT-*` / `MSYS_NT-*` / `CYGWIN_NT-*` â†’ `osType = "Windows (MINGW64)"` ç­‰

**RemoteEnvInfo ç»“æ„**ï¼š
```rust
pub struct RemoteEnvInfo {
    os_type: String,        // "Linux", "Darwin", "Windows", "Windows (MINGW64)", ...
    os_version: String,     // "5.15.0-generic", "10.0.19045", ...  
    kernel: String,         // (Unix only) kernel version
    arch: String,           // "x86_64", "aarch64", "AMD64", ...
    shell: String,          // "/bin/zsh", "cmd.exe", ...
    detected_at: u64,       // Unix timestamp (ms)
}
```

**Tri-State å¤„ç†**ï¼ˆå¼‚æ­¥ç«æ€ï¼‰ï¼š
- `undefined` â†’ æ£€æµ‹è¿›è¡Œä¸­ï¼ŒPrompt æ˜¾ç¤º `[detecting...]`
- `null` â†’ æ£€æµ‹å¤±è´¥ï¼Œä½¿ç”¨å›é€€æç¤º
- `RemoteEnvInfo` â†’ æ­£å¸¸æ˜¾ç¤ºå®Œæ•´ç¯å¢ƒä¿¡æ¯

**æ”¹åŠ¨æ–‡ä»¶**ï¼š
- `src-tauri/src/session/env_detector.rs`ï¼ˆæ–°å¢ ~560 è¡Œï¼‰ï¼šæ ¸å¿ƒæ£€æµ‹é€»è¾‘
- `src-tauri/src/ssh/connection_registry.rs`ï¼š`ConnectionEntry` å¢åŠ  `remote_env` å­—æ®µï¼Œè¿æ¥å»ºç«‹å spawn æ£€æµ‹ä»»åŠ¡
- `src-tauri/src/commands/ssh.rs`ï¼šæ–°å¢ `get_remote_env` å‘½ä»¤
- `src/types/index.ts`ï¼šæ–°å¢ `RemoteEnvInfo` æ¥å£ï¼Œæ‰©å±• `SshConnectionInfo`
- `src/lib/api.ts`ï¼šæ–°å¢ `getRemoteEnv()` API
- `src/store/appStore.ts`ï¼šæ–°å¢ `updateConnectionRemoteEnv` action
- `src/hooks/useConnectionEvents.ts`ï¼šç›‘å¬ `env:detected` Tauri äº‹ä»¶
- `src/lib/sidebarContextProvider.ts`ï¼š`EnvironmentSnapshot` æ‰©å±• `remoteEnv`ï¼ŒSidebar Chat prompt æ³¨å…¥è¿œç¨‹ç¯å¢ƒ
- `src/components/terminal/AiInlinePanel.tsx`ï¼šæ–°å¢ `sessionId` / `terminalType` propsï¼Œ`buildOSContext()` æ„å»º SSH æ„ŸçŸ¥çš„ OS ä¸Šä¸‹æ–‡
- `src/components/terminal/TerminalView.tsx` & `LocalTerminalView.tsx`ï¼šä¼ é€’æ–° props è‡³ `AiInlinePanel`

**æ–‡æ¡£**ï¼š
- `docs/ENV_DETECTOR.md`ï¼ˆæ–°å¢ï¼‰ï¼šå®Œæ•´è®¾è®¡æ–‡æ¡£

---

## 2026-02-07: AI API Key å®‰å…¨å­˜å‚¨å‡çº§ (v1.6.0)

### ğŸ”’ å®‰å…¨å‡çº§

#### AI API Key å­˜å‚¨è¿ç§»è‡³ OS Keychain

**é—®é¢˜**ï¼šv1.5.x åŠä¹‹å‰ç‰ˆæœ¬çš„ AI API Key ä½¿ç”¨ XOR æ··æ·†æ–‡ä»¶ï¼ˆ`ai_keys/*.vault`ï¼‰å­˜å‚¨ï¼Œå®‰å…¨æ€§ç­‰åŒäºæ˜æ–‡ã€‚XOR å¯†é’¥ç”±å¯é¢„æµ‹çš„æœºå™¨æŒ‡çº¹ï¼ˆ`hostname + username`ï¼‰æ´¾ç”Ÿï¼Œæ— å¯†ç å­¦ä¿æŠ¤ã€‚

**è§£å†³**ï¼šå°† AI API Key å­˜å‚¨ç»Ÿä¸€è¿ç§»è‡³æ“ä½œç³»ç»ŸåŸç”Ÿå®‰å…¨å­˜å‚¨ï¼š
- **macOS**: Keychain Servicesï¼ˆ`com.oxideterm.ai` æœåŠ¡ï¼‰
- **Windows**: Credential Manager
- **Linux**: Secret Serviceï¼ˆlibsecret / gnome-keyringï¼‰
- ä¸ SSH å¯†ç äº«æœ‰åŒç­‰ OS çº§åˆ«åŠ å¯†ä¿æŠ¤

**æ”¹åŠ¨æ–‡ä»¶**ï¼š
- `src-tauri/src/commands/config.rs`ï¼š5 ä¸ª `*_ai_provider_*` å‘½ä»¤ä» `AiProviderVault` æ”¹ä¸º `Keychain` è°ƒç”¨
- `src-tauri/src/config/vault.rs`ï¼šæ ‡è®°ä¸º DEPRECATEDï¼Œä»…ä¿ç•™ä¾›è¿ç§»è¯»å–
- `src-tauri/src/config/mod.rs`ï¼šæ›´æ–°æ¨¡å—æ–‡æ¡£

**è¿ç§»æœºåˆ¶**ï¼š
- **æ‡’è¿ç§»**ï¼šé¦–æ¬¡è¯»å– provider key æ—¶è‡ªåŠ¨æ£€æµ‹æ—§ vault æ–‡ä»¶ â†’ è§£å¯† â†’ å­˜å…¥ keychain â†’ åˆ é™¤ vault æ–‡ä»¶
- **é›¶ç”¨æˆ·å¹²é¢„**ï¼šç”¨æˆ·æ— éœ€æ‰‹åŠ¨æ“ä½œï¼Œå‡çº§åé¦–æ¬¡ä½¿ç”¨ AI æ—¶è‡ªåŠ¨å®Œæˆ
- **å…¼å®¹æ€§**ï¼š`has_ai_provider_api_key` åŒæ—¶æ£€æŸ¥ keychain å’Œé—ç•™ vault æ–‡ä»¶

**å‰ç«¯**ï¼šé›¶æ”¹åŠ¨ï¼ˆTauri å‘½ä»¤ç­¾åä¸å˜ï¼‰

### ğŸ“ æ–‡æ¡£æ›´æ–°
- `README.md` / `README.zh-CN.md` / `README.fr.md`ï¼šå®‰å…¨ç« èŠ‚æ–°å¢ AI API Key å­˜å‚¨è¯´æ˜
- `docs/AI_INLINE_CHAT.md`ï¼šAPI Key å­˜å‚¨æè¿°ä» "æœ¬åœ°åŠ å¯†ä¿é™©ç®±" æ”¹ä¸º "ç³»ç»Ÿé’¥åŒ™ä¸²"
- `docs/AI_SIDEBAR_CHAT.md`ï¼šé…ç½®è¡¨æ ‡æ³¨ keychain å­˜å‚¨
- `docs/SYSTEM_INVARIANTS.md`ï¼šæ–°å¢ AI API Key ä¸å˜é‡

### ğŸ§¹ æ—§ç‰ˆ API æ¸…ç†

#### Legacy AI å• Key API â†’ Keychain è·¯ç”±

**é—®é¢˜**ï¼šæ—§ç‰ˆ `set_ai_api_key` / `get_ai_api_key` / `has_ai_api_key` / `delete_ai_api_key` ä»ç›´æ¥ä½¿ç”¨ XOR vault å†™å…¥ï¼Œä¸æ–°ç‰ˆ keychain å­˜å‚¨ä¸ä¸€è‡´ã€‚

**è§£å†³**ï¼š
- 4 ä¸ªæ—§å‘½ä»¤å…¨éƒ¨é‡å†™ä¸º keychain shimï¼Œä»¥ `builtin-openai` ä¸º provider ID é€ä¼ è‡³ `ai_keychain`
- ç§»é™¤ `AiVault` import å’Œ `get_ai_vault()` helperï¼Œå½»åº•åˆ‡æ–­ vault å†™å…¥è·¯å¾„
- `SettingsModal` ç§»é™¤æ•´ä¸ª AI é€‰é¡¹å¡ UIï¼Œæ›¿æ¢ä¸º"â†’ Settings"è·³è½¬æŒ‰é’®
- `list_ai_provider_keys` ç¡¬ç¼–ç  ID æ›´æ–°ä¸º `builtin-*` å‰ç¼€ï¼ŒåŒ¹é…å‰ç«¯çº¦å®š

---

## 2026-02-06: èµ„æºç›‘æ§å™¨ & æ–‡ä»¶ç®¡ç†å™¨å¢å¼º (v1.5.0)

### âœ¨ æ–°ç‰¹æ€§

#### 1. èµ„æºç›‘æ§å™¨ (Resource Profiler)

å®æ—¶é‡‡æ ·è¿œç¨‹ Linux ä¸»æœºçš„ CPUã€å†…å­˜ã€è´Ÿè½½å’Œç½‘ç»œæŒ‡æ ‡ã€‚

**åç«¯** (`session/profiler.rs`, ~760 è¡Œ)ï¼š
- **æŒä¹…åŒ– Shell é€šé“**ï¼šæ•´ä¸ªç”Ÿå‘½å‘¨æœŸä»…æ‰“å¼€ 1 ä¸ª Shell Channelï¼Œé¿å… MaxSessions è€—å°½
- **è½»é‡é‡‡æ ·**ï¼šç²¾ç®€å‘½ä»¤è¾“å‡º ~500-1.5KBï¼ˆ`head -1 /proc/stat` + `grep MemTotal|MemAvailable`ï¼‰ï¼Œ10s é—´éš”
- **Delta è®¡ç®—**ï¼šCPU% å’Œç½‘ç»œé€Ÿç‡åŸºäºä¸¤æ¬¡é‡‡æ ·å·®å€¼ï¼Œé¦–æ¬¡è¿”å› `None`
- **ä¼˜é›…é™çº§**ï¼šé Linux ä¸»æœºæˆ–è¿ç»­ 3 æ¬¡å¤±è´¥åè‡ªåŠ¨é™çº§åˆ° RTT-Only æ¨¡å¼
- **è‡ªåŠ¨ç”Ÿå‘½å‘¨æœŸ**ï¼šé€šè¿‡ `subscribe_disconnect()` ç»‘å®šï¼ŒSSH æ–­è¿è‡ªåŠ¨åœæ­¢
- **std::sync::RwLock**ï¼šæçŸ­ä¸´ç•ŒåŒºé¿å… async è°ƒåº¦å¼€é”€ï¼Œå‡å°‘ç»ˆç«¯ PTY I/O ç«äº‰
- **ProfilerRegistry**ï¼šDashMap æ³¨å†Œè¡¨ + 4 ä¸ª Tauri å‘½ä»¤ + åº”ç”¨é€€å‡ºç»Ÿä¸€æ¸…ç†
- **8+ å•å…ƒæµ‹è¯•**ï¼šè¦†ç›– `/proc` è§£æã€delta è®¡ç®—ã€é¦–é‡‡ç©ºå€¼ã€ç©ºè¾“å‡ºé™çº§

**å‰ç«¯**ï¼š
- `profilerStore.ts`ï¼šZustand Storeï¼Œper-connection çŠ¶æ€ï¼ŒTauri Event è®¢é˜…
- `api.ts`ï¼š4 ä¸ª API åŒ…è£…å‡½æ•°
- `types/index.ts`ï¼š`ResourceMetrics` / `MetricsSource` ç±»å‹å®šä¹‰
- 11 ç§è¯­è¨€ i18n æ”¯æŒï¼ˆ`src/locales/*/profiler.json`ï¼‰

**æ€§èƒ½å½±å“**ï¼š~6-12 KB/min é¢å¤– SSH å¸¦å®½ï¼Œå†…å­˜ ~30 KB/è¿æ¥

> è¯¦è§ [docs/RESOURCE_PROFILER.md](../RESOURCE_PROFILER.md)

### ğŸ”§ ä¿®å¤

#### 1. æ–‡ä»¶é¢„è§ˆçª—å£æ¨¡å¼æº¢å‡ºä¿®å¤
- **é—®é¢˜**ï¼šQuickLook é¢„è§ˆçª—å£åœ¨çª—å£åŒ–æ¨¡å¼ä¸‹è¶…å‡ºåº”ç”¨è¾¹ç•Œè¢«è£å‰ª
- **åŸå› **ï¼š`fixed inset-0 z-50` å®šä½åœ¨ `absolute inset-0 z-10` çš„ tab wrapper å†…éƒ¨ï¼Œå—ç¥–å…ˆ `overflow: hidden` è£å‰ª
- **è§£å†³**ï¼šä½¿ç”¨ `createPortal(â€¦, document.body)` å°†é¢„è§ˆ overlay æ¸²æŸ“åˆ° `<body>`ï¼Œè„±ç¦» stacking context
- **é¢å¤–ä¼˜åŒ–**ï¼š
  - èƒŒæ™¯å±‚æ·»åŠ  `overflow-auto`ï¼Œé¢æ¿æ·»åŠ  `m-auto shrink-0`
  - `minWidth`/`minHeight` ç”¨ `min()` å‡½æ•°é’³ä½åˆ°è§†å£å°ºå¯¸ï¼Œé˜²æ­¢å°çª—å£æº¢å‡º

#### 2. `opener:allow-open-path` æƒé™é”™è¯¯
- **é—®é¢˜**ï¼šæ–‡ä»¶ç®¡ç†å™¨ä¸­"æ‰“å¼€æ–¹å¼"è°ƒç”¨ `openPath()` æŠ¥é”™ `opener.open_path not allowed`
- **è§£å†³**ï¼šåœ¨ `capabilities/default.json` ä¸­æ·»åŠ  `opener:allow-open-path` scope é…ç½®ï¼Œå…è®¸æ‰€æœ‰è·¯å¾„ (`"path": "**"`)

#### 3. Dotfile è·¯å¾„æ— æ³•ç”¨å¤–éƒ¨ç¨‹åºæ‰“å¼€
- **é—®é¢˜**ï¼š`.bashrc`ã€`.ssh` ç­‰ä»¥ç‚¹å¼€å¤´çš„è·¯å¾„ä¸åŒ¹é… `**` é€šé…ç¬¦
- **è§£å†³**ï¼šåœ¨ `tauri.conf.json` çš„ `plugins` ä¸­ä¸º `opener` æ·»åŠ  `"requireLiteralLeadingDot": false`

---

## 2026-02-05: å‘å¸ƒæµç¨‹è‡ªåŠ¨åŒ– & è·¨å¹³å°ä¿®å¤ (v1.4.5)

### ğŸ”§ ä¿®å¤

#### 1. Windows ç¼–è¯‘å…¼å®¹æ€§ä¿®å¤
- **é—®é¢˜**ï¼š`std::os::unix::fs::PermissionsExt` åœ¨ Windows ä¸Šä¸å­˜åœ¨å¯¼è‡´ç¼–è¯‘å¤±è´¥
- **è§£å†³**ï¼šæ·»åŠ  `#[cfg(unix)]` æ¡ä»¶ç¼–è¯‘åˆ° Unix å¹³å°ä¸“å± imports
  - `src/commands/oxide_import.rs`: PermissionsExt
  - `src/local/pty.rs`: std::path::Path (ä»… Unix PATH æ‰©å±•ä½¿ç”¨)

#### 2. TypeScript ç¼–è¯‘é”™è¯¯ä¿®å¤
- **é—®é¢˜**ï¼š`AiSidebar.tsx` ä¸­ `aiEnabled` å˜é‡å£°æ˜ä½†æœªä½¿ç”¨
- **è§£å†³**ï¼šä½¿ç”¨ `aiEnabled` æ§åˆ¶ AI ä¾§è¾¹æ æ˜¾ç¤ºé€»è¾‘ï¼šå½“ AI åŠŸèƒ½ç¦ç”¨æ—¶è‡ªåŠ¨éšè—ä¾§è¾¹æ 

### âœ¨ æ–°ç‰¹æ€§

#### 1. è‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ

æ–°å¢ä¸¤ä¸ª Node.js è„šæœ¬å®ç°ç‰ˆæœ¬å·ç»Ÿä¸€ç®¡ç†å’Œå‘å¸ƒè¯´æ˜ç”Ÿæˆï¼š

**scripts/bump-version.cjs**
- ä¸€æ¬¡æ€§æ›´æ–° `package.json`ã€`Cargo.toml`ã€`tauri.conf.json` ä¸‰ä¸ªæ–‡ä»¶çš„ç‰ˆæœ¬å·
- è‡ªåŠ¨æ›´æ–° README æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬ badgeï¼ˆæ”¯æŒ en/zh-CN/fr ä¸‰ä¸ªè¯­è¨€ï¼‰
- æ”¯æŒ `--dry-run` æ¨¡å¼é¢„è§ˆæ›´æ”¹
- Semver æ ¼å¼éªŒè¯

```bash
pnpm version:bump 1.4.5          # æ›´æ–°ç‰ˆæœ¬
pnpm version:bump 1.5.0 --dry-run  # é¢„è§ˆæ›´æ”¹
pnpm version:check               # æ£€æŸ¥ç‰ˆæœ¬ä¸€è‡´æ€§
```

**scripts/release-notes.cjs**
- ä» `docs/changelog/YYYY-MM.md` æå–æŒ‡å®šç‰ˆæœ¬çš„æ›´æ–°å†…å®¹
- è‡ªåŠ¨ç”Ÿæˆå¹³å°å®‰è£…è¯´æ˜ï¼ˆmacOS xattrã€Windows SmartScreenã€Linux AppImage/debï¼‰
- æ”¯æŒåŒè¯­å®‰è£…æŒ‡å—ï¼ˆä¸­è‹±æ–‡ï¼‰
- è¾“å‡ºåˆ° `RELEASE_NOTES.md` æˆ– stdout

```bash
pnpm release:notes 1.4.5         # ç”Ÿæˆ RELEASE_NOTES.md
pnpm release:notes 1.4.5 --stdout  # è¾“å‡ºåˆ°ç»ˆç«¯
```

#### 2. GitHub Actions é›†æˆ

å¢å¼º `.github/workflows/build.yml`ï¼š
- **è‡ªåŠ¨æå– release notes**ï¼šæ„å»ºæ—¶è¿è¡Œ `release:notes` è„šæœ¬
- **ç”Ÿæˆå®Œæ•´å‘å¸ƒè¯´æ˜**ï¼šåŒ…å« changelog å†…å®¹ + å¹³å°å®‰è£…æŒ‡å—
- **è·¨å¹³å°å…¼å®¹**ï¼šä½¿ç”¨ `shell: bash` ç¡®ä¿ Windows runner ä¹Ÿèƒ½æ‰§è¡Œ Bash è¯­æ³•
- **å¤±è´¥å›é€€**ï¼šå¦‚æœ changelog æ¡ç›®ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤æ¶ˆæ¯

**å‘å¸ƒæµç¨‹**ï¼š
```bash
pnpm version:bump X.Y.Z
# ç¼–è¾‘ docs/changelog/YYYY-MM.md æ·»åŠ æ›´æ–°å†…å®¹
git add -A && git commit -m "chore: bump version to X.Y.Z"
git tag vX.Y.Z
git push && git push --tags
# CI è‡ªåŠ¨æ„å»ºå¹¶å‘å¸ƒï¼Œrelease notes è‡ªåŠ¨ç”Ÿæˆ
```

### ğŸ“š æ–‡æ¡£æ›´æ–°
- æ–°å¢ç‰ˆæœ¬ç®¡ç†è„šæœ¬ä½¿ç”¨è¯´æ˜
- æ›´æ–°å‘å¸ƒæµç¨‹æ–‡æ¡£ï¼ˆè‡ªåŠ¨åŒ– changelog æå–ï¼‰

---

## 2026-02-05: .oxide å¯¼å‡ºå¢å¼º - ç§é’¥å†…åµŒ & Pre-flight æ£€æŸ¥ (v1.4.4)

### âœ¨ æ–°ç‰¹æ€§

#### 1. ç§é’¥å†…åµŒæ”¯æŒï¼ˆEmbed Private Keysï¼‰

å¯¼å‡º .oxide æ–‡ä»¶æ—¶å¯é€‰æ‹©å†…åµŒç§é’¥æ–‡ä»¶å†…å®¹ï¼Œå®ç°çœŸæ­£çš„å¯ç§»æ¤å¤‡ä»½ï¼š

**åŠŸèƒ½äº®ç‚¹**
- âœ… **å®Œå…¨å¯ç§»æ¤**ï¼šå•ä¸€ .oxide æ–‡ä»¶åŒ…å«æ‰€æœ‰è®¤è¯å‡­è¯
- âœ… **è·¨å¹³å°è¿ç§»**ï¼šä» macOS å¯¼å‡ºï¼Œåœ¨ Windows å¯¼å…¥è‡ªåŠ¨å¤„ç†è·¯å¾„
- âœ… **æ™ºèƒ½æå–**ï¼šå¯¼å…¥æ—¶è‡ªåŠ¨æå–åˆ° `~/.ssh/imported/`ï¼Œæƒé™è‡ªåŠ¨è®¾ä¸º `600`
- âœ… **å®‰å…¨åŠ å¯†**ï¼šç§é’¥åœ¨ ChaCha20-Poly1305 AEAD åŠ å¯†ä¿æŠ¤ä¸‹

**åç«¯å®ç°**
```rust
// src/commands/oxide_export.rs
#[derive(Debug, Serialize, Deserialize)]
pub struct EmbeddedKeyData {
    pub content: Vec<u8>,         // å¯†é’¥æ–‡ä»¶åŸå§‹å†…å®¹
    pub original_path: String,    // åŸå§‹è·¯å¾„ï¼ˆç”¨äºå¯¼å…¥æ—¶æ¢å¤ï¼‰
    pub file_name: String,        // æ–‡ä»¶å
    pub size_bytes: u64,          // æ–‡ä»¶å¤§å°
}

// EncryptedAuth æšä¸¾æ‰©å±•
pub enum EncryptedAuth {
    Key { 
        key_path: String,
        passphrase: Option<String>,
        embedded_key: Option<EmbeddedKeyData>,  // æ–°å¢å­—æ®µ
    },
    Certificate {
        key_path: String,
        cert_path: String,
        passphrase: Option<String>,
        embedded_key: Option<EmbeddedKeyData>,  // æ–°å¢å­—æ®µ
    },
    // ...
}
```

**ç”¨æˆ·åœºæ™¯**
1. **è®¾å¤‡è¿ç§»**ï¼šä»æ—§ç”µè„‘å¯¼å‡ºå…¨éƒ¨é…ç½®ï¼Œåœ¨æ–°ç”µè„‘ä¸€é”®æ¢å¤
2. **è¿œç¨‹åŠå…¬**ï¼šåœ¨å®¶åº­/å…¬å¸è®¾å¤‡é—´åŒæ­¥å®Œæ•´é…ç½®
3. **ç¾éš¾æ¢å¤**ï¼šå•ä¸€åŠ å¯†å¤‡ä»½æ–‡ä»¶ï¼Œæ— éœ€ç®¡ç†å¤šä¸ªå¯†é’¥æ–‡ä»¶

#### 2. å¯¼å‡º Pre-flight æ£€æŸ¥

å¯¼å‡ºå‰æ™ºèƒ½åˆ†æé€‰ä¸­è¿æ¥ï¼Œæä¾›è¯¦ç»†çš„è®¤è¯ç±»å‹ç»Ÿè®¡å’Œå¯†é’¥æ–‡ä»¶æ£€æµ‹ï¼š

**åŠŸèƒ½äº®ç‚¹**
- ğŸ“Š **è®¤è¯åˆ†å¸ƒç»Ÿè®¡**ï¼šå®æ—¶æ˜¾ç¤ºå¯†ç /å¯†é’¥/Agent è®¤è¯æ•°é‡
- âš ï¸ **ç¼ºå¤±å¯†é’¥è­¦å‘Š**ï¼šæ£€æµ‹æ— æ³•è®¿é—®çš„å¯†é’¥æ–‡ä»¶å¹¶é«˜äº®æç¤º
- ğŸ“¦ **å¤§å°é¢„è§ˆ**ï¼šå†…åµŒå¯†é’¥æ—¶é¢„è§ˆæ–‡ä»¶å¢åŠ çš„å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰
- ğŸ” **å®æ—¶éªŒè¯**ï¼š300ms é˜²æŠ–ï¼Œé€‰æ‹©å˜åŒ–è‡ªåŠ¨é‡æ–°æ£€æŸ¥

**åç«¯å®ç°**
```rust
// src/commands/oxide_export.rs
#[tauri::command]
pub async fn preflight_export(
    connection_ids: Vec<String>,
    embed_keys: Option<bool>,
    state: tauri::State<'_, ConfigState>,
) -> Result<ExportPreflightResult, String> {
    // åˆ†æé€‰ä¸­è¿æ¥
    // æ£€æµ‹å¯†é’¥æ–‡ä»¶å­˜åœ¨æ€§ï¼ˆembed_keys=true æ—¶ï¼‰
    // è¿”å›è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
}

#[derive(Debug, Serialize, Deserialize)]
pub struct ExportPreflightResult {
    pub total_connections: usize,
    pub connections_with_passwords: usize,
    pub connections_with_keys: usize,
    pub connections_with_agent: usize,
    pub missing_keys: Vec<(String, String)>,  // (è¿æ¥å, å¯†é’¥è·¯å¾„)
    pub total_key_bytes: u64,
    pub can_export: bool,
}
```

**å‰ç«¯ UI å¢å¼º**
```tsx
// å¯¼å‡ºæ¦‚è§ˆé¢æ¿ï¼ˆå®æ—¶æ›´æ–°ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›¡ï¸ å¯¼å‡ºæ¦‚è§ˆ          [spinning...]  â”‚
â”‚                                      â”‚
â”‚ ğŸ”’ 3 ä¸ªå¯†ç è®¤è¯                      â”‚
â”‚ ğŸ”‘ 5 ä¸ªå¯†é’¥è®¤è¯                      â”‚
â”‚ ğŸ¤– 2 ä¸ª Agent è®¤è¯                   â”‚
â”‚                                      â”‚
â”‚ âš ï¸ 2 ä¸ªå¯†é’¥æ–‡ä»¶æœªæ‰¾åˆ°ï¼š               â”‚
â”‚   â€¢ Server-A: /path/not/found.pem   â”‚
â”‚   â€¢ Server-B: ~/.ssh/missing_key    â”‚
â”‚                                      â”‚
â”‚ ğŸ“¦ å¯†é’¥æ•°æ®æ€»è®¡: 3.2 KB              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. å¯¼å‡ºè¿›åº¦é˜¶æ®µæ˜¾ç¤º

å¯¼å‡ºè¿‡ç¨‹æ‹†åˆ†ä¸ºå¯è§†åŒ–é˜¶æ®µï¼Œæä¾›æ¸…æ™°çš„æ“ä½œåé¦ˆï¼š

**é˜¶æ®µæµç¨‹**
```
1ï¸âƒ£ è¯»å–å¯†é’¥... (embed_keys å¯ç”¨æ—¶)
      â†“
2ï¸âƒ£ Argon2id åŠ å¯†...
      â†“  
3ï¸âƒ£ å†™å…¥æ–‡ä»¶...
      â†“
âœ… å®Œæˆï¼
```

**å‰ç«¯å®ç°**
```tsx
type ExportStage = 
  | 'idle' 
  | 'reading_keys' 
  | 'encrypting' 
  | 'writing' 
  | 'done';

// æŒ‰é’®çŠ¶æ€éšé˜¶æ®µå˜åŒ–
{exporting ? (
  <span className="flex items-center gap-2">
    <Loader2 className="h-4 w-4 animate-spin" />
    {getStageText()}  // "è¯»å–å¯†é’¥..." / "åŠ å¯†ä¸­..." / "å†™å…¥æ–‡ä»¶..."
  </span>
) : (
  t('modals.export.export')
)}
```

### ğŸŒ å›½é™…åŒ–

æ‰€æœ‰æ–°åŠŸèƒ½å®Œæ•´æ”¯æŒ 11 ç§è¯­è¨€ï¼š
- è‹±è¯­ã€ç®€ä½“ä¸­æ–‡ã€ç¹ä½“ä¸­æ–‡
- å¾·è¯­ã€è¥¿ç­ç‰™è¯­ã€æ³•è¯­ã€æ„å¤§åˆ©è¯­
- æ—¥è¯­ã€éŸ©è¯­ã€è‘¡è„ç‰™è¯­ï¼ˆå·´è¥¿ï¼‰ã€è¶Šå—è¯­

**æ–°å¢ç¿»è¯‘ key**
```json
{
  "summary_title": "å¯¼å‡ºæ¦‚è§ˆ",
  "summary_passwords": "{{count}} ä¸ªä½¿ç”¨å¯†ç ",
  "summary_keys": "{{count}} ä¸ªä½¿ç”¨å¯†é’¥",
  "summary_agent": "{{count}} ä¸ªä½¿ç”¨ä»£ç†",
  "warning_missing_keys": "{{count}} ä¸ªå¯†é’¥æ–‡ä»¶æœªæ‰¾åˆ°ï¼š",
  "key_size": "å¯†é’¥æ•°æ®æ€»è®¡ï¼š{{size}}",
  "stage_reading_keys": "è¯»å–å¯†é’¥...",
  "stage_encrypting": "åŠ å¯†ä¸­...",
  "stage_writing": "å†™å…¥æ–‡ä»¶...",
  "stage_done": "å®Œæˆï¼",
  "error_export_failed": "å¯¼å‡ºå¤±è´¥"
}
```

### ğŸ“š æ–‡æ¡£æ›´æ–°

- `docs/SERIALIZATION.md`ï¼šæ–°å¢ç§é’¥å†…åµŒæœºåˆ¶å’Œ Pre-flight æ£€æŸ¥è¯´æ˜
- `docs/USER_GUIDE.md`ï¼šæ›´æ–°å¯¼å‡º/å¯¼å…¥æµç¨‹ï¼Œæ·»åŠ æ–°åŠŸèƒ½ä½¿ç”¨æŒ‡å—

### ğŸ› ï¸ æŠ€æœ¯å®ç°

**åç«¯æ¶æ„**
- `src/commands/oxide_export.rs`ï¼šæ–°å¢ `preflight_export` å‘½ä»¤
- `check_key_file_exists()`ï¼šå¯†é’¥æ–‡ä»¶å­˜åœ¨æ€§æ£€æµ‹ï¼ˆæ”¯æŒ `~` å±•å¼€ï¼‰
- `EmbeddedKeyData` ç»“æ„ï¼šå­˜å‚¨å¯†é’¥å†…å®¹å’Œå…ƒæ•°æ®

**å‰ç«¯æ¶æ„**
- `OxideExportModal.tsx`ï¼šå®Œå…¨é‡å†™ï¼Œæ–°å¢ preflight é›†æˆ
- å®æ—¶æ£€æµ‹ï¼š300ms é˜²æŠ– + `useCallback` ä¼˜åŒ–
- å“åº”å¼ UIï¼šæ ¹æ® preflight ç»“æœåŠ¨æ€æ˜¾ç¤ºè­¦å‘Šå’Œç»Ÿè®¡

---

## 2026-02-05: ç«¯å£è½¬å‘å†…å­˜å®‰å…¨å¢å¼º (v1.4.3)

### ğŸ”§ æ¶æ„é‡æ„

#### æ— é” Channel I/O æ¶æ„

é‡æ„äº† `local.rs`ã€`remote.rs`ã€`dynamic.rs` ä¸­çš„æ•°æ®æ¡¥æ¥é€»è¾‘ï¼Œä» `Arc<Mutex<Channel>>` å‡çº§ä¸ºæ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼š

**é—®é¢˜èƒŒæ™¯**
- æ—§æ¶æ„ä¸­ï¼Œè¯»å†™ä»»åŠ¡ç«äº‰åŒä¸€ä¸ª Mutex é”
- æŒé”è°ƒç”¨ `.await` å¯èƒ½å¯¼è‡´å…¶ä»–ä»»åŠ¡é•¿æ—¶é—´ç­‰å¾…
- æŸäº›è¾¹ç¼˜æƒ…å†µä¸‹å­˜åœ¨æ­»é”é£é™©

**æ–°æ¶æ„**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  handle_forward_connection                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   mpsc    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ local_readerâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   ssh_io                    â”‚  â”‚
â”‚  â”‚ (æ— é”è¯»)    â”‚           â”‚   (å•ç‹¬æŒæœ‰ Channel,        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚    æ— éœ€ Mutex)              â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   mpsc    â”‚                             â”‚  â”‚
â”‚  â”‚ local_writerâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚  â”‚
â”‚  â”‚ (æ— é”å†™)    â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚  shutdown_rx â† æ¥è‡ªä¸»ä»»åŠ¡çš„ broadcast ä¿¡å·                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®æ”¹è¿›**
| æ”¹è¿›é¡¹ | è¯´æ˜ |
|--------|------|
| **Channel å•æ‰€æœ‰æƒ** | SSH Channel ç”± `ssh_io` ä»»åŠ¡ç‹¬å æŒæœ‰ï¼Œæ— éœ€ Mutex |
| **mpsc è§£è€¦** | è¯»å†™ä»»åŠ¡é€šè¿‡ `mpsc::channel` ä¸ SSH I/O ä»»åŠ¡é€šä¿¡ |
| **ä¿¡å·ä¼ æ’­** | å­è¿æ¥ä»»åŠ¡è®¢é˜… `shutdown_rx`ï¼ŒSSH æ–­å¼€æ—¶ä¸»åŠ¨é€€å‡º |
| **å…¨é“¾è·¯è¶…æ—¶** | æ‰€æœ‰ I/O æ“ä½œéƒ½æœ‰ `IDLE_TIMEOUT` (300s) ä¿æŠ¤ |

#### å­ä»»åŠ¡ Shutdown ä¿¡å·ä¼ æ’­

ä¿®å¤äº†å­è¿æ¥ä»»åŠ¡ï¼ˆæ¯ä¸ª accept çš„ TCP è¿æ¥ï¼‰æœªç›‘å¬ SSH æ–­å¼€ä¿¡å·çš„é—®é¢˜ï¼š

```rust
// ä¸»ä»»åŠ¡åˆ›å»º broadcast é€šé“
let (child_shutdown_tx, _) = broadcast::channel::<()>(16);

// æ¯ä¸ªå­ä»»åŠ¡è®¢é˜… shutdown ä¿¡å·
let mut child_shutdown_rx = child_shutdown_tx.subscribe();

// å­ä»»åŠ¡å†…éƒ¨ç›‘å¬
tokio::select! {
    _ = shutdown_rx.recv() => {
        debug!("Received shutdown signal");
        break;
    }
    // ... å…¶ä»– I/O æ“ä½œ
}
```

#### remote.rs è¶…æ—¶ä¿æŠ¤

ä¸º `bridge_forwarded_connection` æ·»åŠ äº†ç¼ºå¤±çš„ `REMOTE_FORWARD_IDLE_TIMEOUT` (300s)ï¼š

```rust
// æ‰€æœ‰ I/O éƒ½æœ‰è¶…æ—¶ä¿æŠ¤
match tokio::time::timeout(REMOTE_FORWARD_IDLE_TIMEOUT, channel.wait()).await {
    Err(_) => {
        debug!("idle timeout, closing connection");
        break;
    }
    // ...
}
```

### ğŸ“š æ–‡æ¡£æ›´æ–°

- `docs/PORT_FORWARDING.md`ï¼šæ›´æ–°è‡³ v1.4.2ï¼Œæ–°å¢æ— é”æ¶æ„ç« èŠ‚
- `README.md` / `README.zh-CN.md` / `README.fr.md`ï¼šæ›´æ–°ç«¯å£è½¬å‘ç‰¹æ€§æè¿°

### ğŸ§¹ ä»£ç æ¸…ç†

ç§»é™¤å¼ƒç”¨çš„ Tauri å‘½ä»¤æ³¨å†Œï¼š
- `connect_v2` â†’ ä½¿ç”¨ `connect_tree_node` + `expand_manual_preset`
- `ssh_connect` â†’ ä½¿ç”¨ `connect_tree_node`

ä¿®å¤ clippy è­¦å‘Šï¼š
- `cert_path` é‡å‘½åä¸º `_cert_path`ï¼ˆæœªä½¿ç”¨å˜é‡ï¼‰
- `ExitReason::Error` æ·»åŠ  `#[allow(dead_code)]` æ³¨è§£

---

## 2026-02-05: AI èŠå¤©æŒä¹…åŒ–åç«¯ (v1.4.2)

### âœ¨ æ–°ç‰¹æ€§

#### AI å¯¹è¯ redb æŒä¹…åŒ–å­˜å‚¨

ä½¿ç”¨ Rust redb åµŒå…¥å¼æ•°æ®åº“æ›¿ä»£ localStorageï¼Œå®ç°é«˜æ€§èƒ½å¯¹è¯æŒä¹…åŒ–ï¼š

**å­˜å‚¨æ¶æ„**
```
~/.config/oxideterm/
â”œâ”€â”€ state.redb            # ä¼šè¯ã€è½¬å‘ã€è®¾ç½®
â””â”€â”€ chat_history.redb     # AI å¯¹è¯ (NEW)
```

**æ•°æ®è¡¨è®¾è®¡**

| è¡¨å | é”® | å€¼ |
|------|-----|-----|
| `conversations` | conversation_id | ConversationMeta (msgpack) |
| `messages` | message_id | PersistedMessage (msgpack) |
| `conversation_messages` | conversation_id | Vec<message_id> |
| `ai_chat_metadata` | key | value |

**æ ¸å¿ƒç‰¹æ€§**
- **zstd å‹ç¼©**ï¼šç¼“å†²åŒºå¿«ç…§ >4KB è‡ªåŠ¨å‹ç¼© (~5x å‹ç¼©ç‡)
- **LRU é©±é€**ï¼šæœ€å¤š 100 ä¸ªå¯¹è¯ï¼Œè¶…é™è‡ªåŠ¨åˆ é™¤æœ€æ—§
- **æ¶ˆæ¯é™åˆ¶**ï¼šæ¯å¯¹è¯æœ€å¤š 200 æ¡æ¶ˆæ¯
- **æ‡’åŠ è½½**ï¼šåˆå§‹ä»…åŠ è½½å¯¹è¯åˆ—è¡¨ï¼Œæ¶ˆæ¯æŒ‰éœ€åŠ è½½
- **ä¸Šä¸‹æ–‡å¿«ç…§**ï¼šæ¯æ¡æ¶ˆæ¯å…³è”å®Œæ•´çš„ç»ˆç«¯ä¸Šä¸‹æ–‡

**Tauri Commands**

| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| `ai_chat_list_conversations` | åˆ—å‡ºå¯¹è¯ (ä»…å…ƒæ•°æ®) |
| `ai_chat_get_conversation` | è·å–å®Œæ•´å¯¹è¯å«æ¶ˆæ¯ |
| `ai_chat_create_conversation` | åˆ›å»ºæ–°å¯¹è¯ |
| `ai_chat_update_conversation` | æ›´æ–°å¯¹è¯å…ƒæ•°æ® |
| `ai_chat_delete_conversation` | åˆ é™¤å¯¹è¯ |
| `ai_chat_save_message` | ä¿å­˜æ¶ˆæ¯ (å«ä¸Šä¸‹æ–‡å¿«ç…§) |
| `ai_chat_update_message` | æ›´æ–°æ¶ˆæ¯å†…å®¹ (æµå¼) |
| `ai_chat_delete_messages_after` | åˆ é™¤æŒ‡å®šæ¶ˆæ¯åå†…å®¹ (é‡æ–°ç”Ÿæˆ) |
| `ai_chat_clear_all` | æ¸…ç©ºæ‰€æœ‰å¯¹è¯ |
| `ai_chat_get_stats` | è·å–æ•°æ®åº“ç»Ÿè®¡ |

#### æ–°å¢æ¨¡å—

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `src-tauri/src/state/ai_chat.rs` | AI èŠå¤© redb å­˜å‚¨å±‚ (~600 è¡Œ) |
| `src-tauri/src/commands/ai_chat.rs` | Tauri å‘½ä»¤å±‚ (~300 è¡Œ) |

#### æ–°å¢ä¾èµ–

- `zstd = "0.13"` - é«˜æ€§èƒ½å‹ç¼©

### ğŸ“š æ–‡æ¡£æ›´æ–°

- `docs/AI_SIDEBAR_CHAT.md`ï¼šæ–°å¢æŒä¹…åŒ–æ¶æ„è¯´æ˜

---

## 2026-02-05: AI ä¸Šä¸‹æ–‡æ³¨å…¥å¢å¼º (v1.4.1)

### âœ¨ æ–°ç‰¹æ€§

#### ä¾§è¾¹æ æ·±åº¦ä¸Šä¸‹æ–‡æ„ŸçŸ¥

å®ç°ç±»ä¼¼ GitHub Copilot çš„æ™ºèƒ½ä¸Šä¸‹æ–‡æ³¨å…¥ï¼ŒAI åŠ©æ‰‹ç°åœ¨è‡ªåŠ¨æ„ŸçŸ¥ï¼š

**1. ç¯å¢ƒå¿«ç…§ (Environment Snapshot)**
- æœ¬åœ° OS æ£€æµ‹ (macOS/Windows/Linux)
- ç»ˆç«¯ç±»å‹è¯†åˆ« (SSH/Local)
- SSH è¿æ¥è¯¦æƒ… (`user@host`)
- è¿œç¨‹ OS æ¨æµ‹ (åŸºäºä¸»æœºåæ¨¡å¼)

**2. åŠ¨æ€ç¼“å†²åŒºåŒæ­¥ (Buffer Sync)**
- è‡ªåŠ¨æ•è·ç»ˆç«¯æœ€å 50 è¡Œè¾“å‡º
- å¯é…ç½®çš„å­—ç¬¦é™åˆ¶ (é»˜è®¤ 8000 å­—ç¬¦)
- æ— éœ€æ‰‹åŠ¨ç‚¹å‡» "Include context"

**3. é€‰åŒºä¼˜å…ˆçº§ (Selection Priority)**
- ç»ˆç«¯é€‰ä¸­æ–‡æœ¬ä½œä¸º "é‡ç‚¹åˆ†æå¯¹è±¡"
- AI è‡ªåŠ¨å°†é€‰åŒºè§†ä¸ºæŸ¥è¯¢ä¸»é¢˜
- å®Œç¾é€‚é…é”™è¯¯è¯Šæ–­åœºæ™¯

#### æ–°å¢æ¨¡å—

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `src/lib/sidebarContextProvider.ts` | ç¯å¢ƒä¸Šä¸‹æ–‡èšåˆå™¨ |

#### terminalRegistry é€‰åŒºæ”¯æŒ

æ‰©å±• `terminalRegistry.ts` æ”¯æŒé€‰åŒºè·å–ï¼š

```typescript
// æ–°å¢ API
export function getActiveTerminalSelection(): string | null;
export function getTerminalSelection(paneId: string): string | null;
export function updateSelectionGetter(paneId, getter): void;

// æ³¨å†Œæ—¶æ”¯æŒå¯é€‰çš„é€‰åŒºè·å–å‡½æ•°
registerTerminalBuffer(paneId, tabId, sessionId, type, bufferGetter, selectionGetter?);
```

#### å†…è” AI VS Code é£æ ¼é‡æ„

- **è§†è§‰æ›´æ–°**ï¼šæ— é®ç½©ã€é˜´å½±è¾¹æ¡†ã€520px å›ºå®šå®½åº¦
- **å…‰æ ‡å®šä½**ï¼šé¢æ¿è·Ÿéšç»ˆç«¯å…‰æ ‡ä½ç½®
- **æ–°å¿«æ·é”®**ï¼šEnter=å‘é€/æ‰§è¡Œï¼ŒTab=æ’å…¥ï¼ŒEsc=å…³é—­
- **åŠ è½½åŠ¨ç”»**ï¼šè“è‰²å¾®å…‰æ¡æŒ‡ç¤ºç”Ÿæˆä¸­

### ğŸ“š æ–‡æ¡£æ›´æ–°

- `docs/AI_SIDEBAR_CHAT.md`ï¼šæ–°å¢ä¸Šä¸‹æ–‡æ³¨å…¥æ¶æ„è¯´æ˜
- `docs/AI_INLINE_CHAT.md`ï¼šæ›´æ–° VS Code é£æ ¼ç•Œé¢è¯´æ˜

---

## 2026-02-04: è¿æ¥æ¶æ„ä¿®å¤ (v1.4.0)

### ğŸ› Bug ä¿®å¤

#### Store é—´åŒæ­¥ç¼ºå¤±å¯¼è‡´ `connectionState=undefined` æ­»é”

**é—®é¢˜ç°è±¡**ï¼š
- SSH é‡è¿æˆåŠŸåï¼ŒSFTPView å’Œ TransferQueue å¡åœ¨ "Waiting for connection"
- æ§åˆ¶å°æ˜¾ç¤º `connectionState=undefined, isConnectionReady=false`
- StateDrift æ—¥å¿—æ˜¾ç¤º `Auto-fixed 1 drift(s)` ä½† UI æ— ååº”

**æ ¹æœ¬åŸå› **ï¼š
`sessionTreeStore.connectNodeInternal()` å’Œ `syncDrift()` åªæ›´æ–° `rawNodes`ï¼Œ
ä¸åŒæ­¥ `appStore.connections`ï¼Œè€Œ SFTPView/TransferQueue ä¾èµ–åè€…åˆ¤æ–­è¿æ¥çŠ¶æ€ã€‚

```
æ—§æ•°æ®æµï¼ˆæ–­è£‚ï¼‰:
  [Backend] SSH Connected
    â†’ [sessionTreeStore] rawNodes æ›´æ–° âœ…
    â†’ [appStore] connections Map æœªæ›´æ–° âŒ
    â†’ [SFTPView] connectionState = undefined â†’ å¡æ­» ğŸ’€
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨ä»¥ä¸‹ä½ç½®æ·»åŠ  `await useAppStore.getState().refreshConnections()`ï¼š

| æ–‡ä»¶ | ä½ç½® | è§¦å‘æ—¶æœº |
|------|------|----------|
| `sessionTreeStore.ts` | `connectNodeInternal()` | SSH è¿æ¥å»ºç«‹æˆåŠŸå |
| `sessionTreeStore.ts` | `syncDrift()` | StateDrift è‡ªåŠ¨ä¿®å¤å |

```
æ–°æ•°æ®æµï¼ˆå®Œæ•´ï¼‰:
  [Backend] SSH Connected
    â†’ [sessionTreeStore] rawNodes æ›´æ–°
    â†’ [refreshConnections()] appStore.connections åŒæ­¥
    â†’ [SFTPView] connectionState = 'active' â†’ æ­£å¸¸åˆå§‹åŒ– âœ…
```

**å½±å“èŒƒå›´**ï¼š
- SFTPView
- TransferQueue
- ForwardsView
- IdeWorkspace

---

### âœ¨ æ–°ç‰¹æ€§

#### Key-Driven Reset æ¨¡å¼

ä¸ºè§£å†³é‡è¿åç»„ä»¶æŒæœ‰è¿‡æœŸçŠ¶æ€çš„é—®é¢˜ï¼Œåœ¨ `AppLayout.tsx` ä¸­å®ç°å¤åˆ Keyï¼š

```tsx
// å½“ connectionId å˜åŒ–æ—¶ï¼ŒReact è‡ªåŠ¨é”€æ¯æ—§ç»„ä»¶ã€åˆ›å»ºæ–°å®ä¾‹
<SFTPView 
  key={`sftp-${tab.sessionId}-${getSession(tab.sessionId)?.connectionId ?? ''}`}
  sessionId={tab.sessionId} 
/>
```

é€‚ç”¨ç»„ä»¶ï¼š
- `SFTPView`
- `ForwardsView`
- `IdeWorkspace`

#### SFTP è·¯å¾„è®°å¿†

è·¨é‡è¿ä¿æŒç”¨æˆ·ç›®å½•ä½ç½®ï¼š

```typescript
// å…¨å±€ Mapï¼ˆæ¨¡å—é¡¶å±‚ï¼‰
const sftpPathMemory = new Map<string, string>();

// ç»„ä»¶æŒ‚è½½æ—¶æ¢å¤
const savedPath = sftpPathMemory.get(sessionId);

// è·¯å¾„å˜åŒ–æ—¶ä¿å­˜
sftpPathMemory.set(sessionId, remotePath);
```

#### TransferQueue çŠ¶æ€é—¨ç¦

è¿æ¥æœªå°±ç»ªæ—¶é™é»˜ç­‰å¾…ï¼Œé¿å… `CONNECTION_NOT_FOUND` é”™è¯¯ï¼š

```typescript
const isConnectionReady = connectionState === 'active' || connectionState === 'idle';

if (!isConnectionReady) {
  console.debug('[TransferQueue] Waiting for connection');
  return;  // ä¸æ‰§è¡Œä»»ä½• API è°ƒç”¨
}
```

---

### ğŸ“š æ–‡æ¡£æ›´æ–°

- `docs/SFTP.md`: æ–°å¢ã€Œè¿æ¥é²æ£’æ€§æ¶æ„ã€ç« èŠ‚
- `docs/ARCHITECTURE.md`: æ›´æ–° SessionTreeStore ç« èŠ‚ï¼Œè¡¥å……åŒ Store åŒæ­¥è¯´æ˜
- `docs/SYSTEM_INVARIANTS.md`: æ–°å¢ã€Œå‰ç«¯ Store é—´åŒæ­¥çº¦æŸã€ç« èŠ‚

---

### ğŸ”§ åç«¯ä¿®å¤

#### AcceptTimeout äº‹ä»¶é€šçŸ¥

WebSocket æ¥å—è¶…æ—¶æ—¶ï¼Œåç«¯ç°åœ¨æ­£ç¡®å‘é€ `connection-status-changed` äº‹ä»¶ï¼š

```rust
// src-tauri/src/commands/ssh.rs
TerminationReason::AcceptTimeout(secs) => {
    // é€šçŸ¥å‰ç«¯è¿æ¥å·²æ–­å¼€
    emit_connection_status_changed(app.clone(), &session_id, "disconnected").await;
}
```

#### è¿æ¥æ± ç»Ÿè®¡ä¿®å¤

SFTP å’Œç«¯å£è½¬å‘ç°åœ¨æ­£ç¡®æ›´æ–° `ConnectionRegistry`ï¼š

```rust
// sftp.rs - sftp_init/sftp_close
connection_registry.set_sftp_session(&connection_id, Some(session_id)).await;

// forwarding.rs - create/stop/delete_port_forward
connection_registry.add_forward(&connection_id, &forward_id).await;
connection_registry.remove_forward(&connection_id, &forward_id).await;
```

---

## ç›¸å…³ Issue

- ä¿®å¤ #TBD: SSH é‡è¿å SFTP æ ‡ç­¾é¡µå¡æ­»
- ä¿®å¤ #TBD: TransferQueue CONNECTION_NOT_FOUND é”™è¯¯

## æµ‹è¯•éªŒè¯

1. è¿æ¥ SSH â†’ æ‰“å¼€ SFTP æ ‡ç­¾é¡µ â†’ è¿›å…¥ç›®å½•
2. æ¨¡æ‹Ÿæ–­ç½‘æˆ–æœåŠ¡å™¨è¶…æ—¶
3. ç­‰å¾…/è§¦å‘é‡è¿
4. éªŒè¯ï¼š
   - `[SFTPView] Init:` æ—¥å¿—ç´§éš `[StateDrift] Auto-fixed` å‡ºç°
   - SFTP æ¢å¤åˆ°ä¹‹å‰çš„ç›®å½•
   - TransferQueue æ—  CONNECTION_NOT_FOUND é”™è¯¯
